\documentclass[$if(fontSize)$$fontSize$,% $endif$%
	$if(language)$$language$,$else$english,$endif$%
	$if(paperSize)$$paperSize$,$else$ a4paper,%
	$endif$$if(classOptions)$$classOptions$,$endif$%
	$if(twoSided)$twosided,$endif$%
	$if(titlepage)$titlepage,$endif$%
	$if(centerEqs)$$else$fleqn$endif$]{$if(documentClass)$%
		$documentClass$$else$article$endif$}
% This is ugly, but if I have it spaced out, pandoc doesn't like it much.

% DO NOT include a slash after your fontDir is set
\def\fontDir{/home/ian/.pandoc/quetzalcoatl/fonts}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{xparse}
\usepackage{xtemplate}


% Physics stuff
\usepackage{braket}
\usepackage[spaced=0]{diffcoeff}
\usepackage{linop}

%% Physics macros
\newcommand{\expval}[1]{\left< #1 \right>}
\newcommand{\comm}[2]{\left[ #1 , #2 \right]}
\newcommand{\acomm}[2]{\left\{ #1, #2 \right\}}

\usepackage{enumerate}
% Keep pandoc from getting mad
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

\renewcommand{\labelenumii}{\arabic{enumi}.\arabic{enumii}.}
\renewcommand{\labelenumiii}{\arabic{enumi}.\arabic{enumii}.\arabic{enumiii}.}
\renewcommand{\labelenumiv}{%
    \arabic{enumi}.\arabic{enumii}.\arabic{enumiii}.\arabic{enumiv}.}

\usepackage{calc}


% NEW MATH COMMANDS

% Include some ISO math symbols

\newcommand\ii{\mathup{i}}

\newcommand\ee{\mathup{e}}



% fix spacing around \left( and \right) commands. Taken from
% https://tex.stackexchange.com/questions/2607/spacing-around-left-and-right 
\let\originalleft\left
\let\originalright\right
\renewcommand{\left}{\mathopen{}\mathclose\bgroup\originalleft}
\renewcommand{\right}{\aftergroup\egroup\originalright}

\usepackage{soul}

\usepackage{siunitx}


$if(titlepage)$
$else$
\usepackage[runin]{abstract}
$endif$

$if(defaultTitle)$
$else$
\makeatletter
\def\@maketitle{%
  \newpage
  \null
  \vskip 2em%
  \begin{flushleft}%
  \let \footnote \thanks
    {\LARGE \textsf \@title \par}%
    \vskip 0.5em%
  \end{flushleft}
  \begin{flushright}
    {\large
      \lineskip .5em%
      \begin{tabular}[t]{r}%
        \noindent \textsf \@author \\
	\textsf \@date
      \end{tabular}\par}%
    %\vskip 1em%
    %{\large \textsf \@date}%
  \end{flushright}%
  \par
  \vskip 1.5em}
\makeatother
$endif$


\usepackage[auto=true]{microtype}

% Set main typeface
$if(customType)$
	$customType$
	% This is set by manually inputting \usepackage{mathspec/fontspec},
	% \setmainfont{foo}, etc.

	$endif$
	%\usepackage{mathspec}
	\usepackage{fontspec}
	\usepackage{unicode-math}

	%\newfontfamily\symbolFont[
		%Extension = {.otf},
		%Path = {\fontDir/fdsymbol/},
		%UprightFont = {*-Regular},
	%]{FdSymbol}

	$if(stixFont)$
	\setmainfont[
		Path = {\fontDir/stix2/},
		Extension = {.otf},
		UprightFont = {*-Regular},
		ItalicFont = {*-Italic},
		BoldFont = {*-Bold},
		BoldItalicFont = {*-BoldItalic},
		RawFeature = {+case}
		]
		{StixTwoText}

	\setmathfont[
		Path = {\fontDir/stix2/},
		Extension = {.otf},
		RawFeature = {+ss15},
		]
		{StixTwoMath-Regular}

	% Heavenly father, forgive me, for I know not what I do.
	\newfontfamily\symbolFont[
		Extension = {.otf},
		Path = {\fontDir/stix2/},
	]{StixTwoMath-Regular}

	$elseif(erewhonFont)$
	\setmainfont[
		Path = {\fontDir/erewhon/},
		Extension = {.otf},
		UprightFont = {*-Regular},
		ItalicFont = {*-Italic},
		BoldFont = {*-Bold},
		BoldItalicFont = {*-BoldItalic}
		]
		{Erewhon}

	\setmathfont[
		Path = {\fontDir/erewhon-math/},
		Extension = {.otf},
		]
		{Erewhon-Math}

	\newfontfamily\symbolFont[
		Extension = {.otf},
		Path = {\fontDir/erewhon-math/},
		]{Erewhon-Math}


	$else$
	\setmainfont[
		Path = {\fontDir/xcharter/},
		Extension = {.otf},
		UprightFont = {*-Roman},
		ItalicFont = {*-Italic},
		BoldFont = {*-Bold},
		BoldItalicFont = {*-BoldItalic}
		]{XCharter}

	\setmathfont[
		Path = {\fontDir/xcharter/},
		Extension = {.otf},
		]{XCharter-Math}

	\newfontfamily\symbolFont[
		Extension = {.otf},
		Path = {\fontDir/xcharter/},
		]{XCharter-Math}
	
	$endif$
	
	$if(notoSans)$
	\setsansfont[
		Path= {\fontDir/notoSans/},
		Extension = {.ttf},
		UprightFont = {*-Regular},
		ItalicFont = {*-Italic},
		BoldFont = {*-Bold},
		BoldItalicFont = {*-BoldItalic},
		Scale = 0.925
		]
		{NotoSans}

	\newfontfamily\titletype[
		Path = {\fontDir/notoSans/},
		Extension = {.ttf},
		UprightFont = {*-Bold},
		ItalicFont = {*-BoldItalic},
		BoldFont = {*-ExtraBold},
		BoldItalicFont = {*-ExtraBoldItalic},
		Scale = 0.925
		]
		{NotoSans}
	\newfontfamily\headType[
		Path = {\fontDir/notoSans/},
		Extension = {.ttf},
		UprightFont = {*-Bold},
		ItalicFont = {*-BoldItalic},
		BoldFont = {*-ExtraBold},
		BoldItalicFont = {*-ExtraBoldItalic},
		Scale = 0.925,
		]
		{NotoSans}
	\newfontfamily\subsubHeadType[
		Path = {\fontDir/notoSans/},
		Extension = {.ttf},
		UprightFont = {*-Medium},
		ItalicFont = {*-MediumItalic},
		BoldFont = {*-SemiBold},
		BoldItalicFont = {*-SemiBoldItalic},
		Scale = 0.925,
		]
		{NotoSans}
$else$
	\setsansfont[
		Path= {\fontDir/Inter/},
		Extension = {.otf},
		UprightFont = {*-Regular},
		ItalicFont = {*-Italic},
		BoldFont = {*-Bold},
		BoldItalicFont = {*-BoldItalic},
		RawFeature = {+cv08, +cv01, +cv07, +cv10, +case, +zero},
		Scale = 0.925,
		]
		{Inter}

	\newfontfamily\titletype[
		Path = {\fontDir/Inter/},
		Extension = {.otf},
		UprightFont = {*-ExtraBold},
		ItalicFont = {*-ExtraBoldItalic},
		BoldFont = {*-Black},
		BoldItalicFont = {*-BlackItalic},
		RawFeature = {+cv08, +cv01, +cv07, +cv10, +case, +zero},
		Scale = 0.925,
		]
		{Inter}

	\newfontfamily\headType[
		Path = {\fontDir/Inter/},
		Extension = {.otf},
		UprightFont = {*-Bold},
		ItalicFont = {*-BoldItalic},
		BoldFont = {*-ExtraBold},
		BoldItalicFont = {*-ExtraBoldItalic},
		RawFeature = {+cv08, +cv01, +cv07, +cv10, +case, +zero},
		Scale = 0.925,
		]
		{Inter}

	\newfontfamily\subsubHeadType[
		Path = {\fontDir/Inter/},
		Extension = {.otf},
		UprightFont = {*-Medium},
		ItalicFont = {*-MediumItalic},
		BoldFont = {*-SemiBold},
		BoldItalicFont = {*-SemiBoldItalic},
		RawFeature = {+cv08, +cv01, +cv07, +cv10, +case, +zero},
		Scale = 0.925,
		]
		{Inter}
	$endif$


	\setmonofont[
	Path = {\fontDir/juliaMono/},
		Extension = {.ttf},
		UprightFont = {*-Regular},
		ItalicFont = {*-RegularItalic},
		BoldFont = {*-Bold},
		BoldItalicFont = {*-BoldItalic},
		Scale = 0.875,
		]
		{JuliaMono}

$if(sansBody)$
	\renewcommand{\familydefault}{\sfdefault}
$endif$

% Set itemize symbols
\renewcommand{\labelitemi}{\symbolFont{▪}}
\renewcommand{\labelitemii}{\symbolFont{▹}}
\renewcommand{\labelitemiii}{\symbolFont{•}}
\renewcommand{\labelitemiv}{\symbolFont{⟶}}

\usepackage{indentfirst}

$if(useEndnotes)$
\usepackage{endnotes}

\let\footnote=\endnote

\renewcommand\footnoterule{\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}}

\def\enoteheading{\par\kern1\baselineskip%
		  \footnoterule%
                  \kern1\baselineskip}

\renewcommand{\theendnote}{[\arabic{endnote}]}

$endif$


$if(language)$

	\usepackage{polyglossia}
	\setmainlanguage{$language$}

$else$

	\usepackage{polyglossia}
	\setmainlanguage{english}

$endif$



$if(fullpage)$
\usepackage{fullpage}
$endif$
$if(lineno)$
  \usepackage[modulo]{lineno}
  \linenumbers
$endif$

\usepackage{fancyhdr}
$if(fancyHdr)$
	$fancyHdr$
	$else$
	\pagestyle{plain}
$endif$

\usepackage{setspace}
$if(lineStretch)$
	\setstretch{$lineStretch$}
	$else$
	\setstretch{1.25}
$endif$

$if(draft)$
	\usepackage{draftwatermark}
$endif$

\usepackage{longtable,booktabs,array}
\usepackage{multirow}

\usepackage[dvipsnames]{xcolor}
\usepackage{pagecolor}
\usepackage{afterpage}
\usepackage{colortbl}
\definecolor{table-row-color}{HTML}{F5F5F5}
\definecolor{table-rule-color}{HTML}{999999}

$if(ruleColor)$
\definecolor{ruleColor}{HTML}{$ruleColor$}
$else$
\definecolor{ruleColor}{HTML}{2c5dbf}
$endif$

%\arrayrulecolor{black!40}
\arrayrulecolor{table-rule-color}     % color of \toprule, \midrule, \bottomrule
\setlength\heavyrulewidth{0.3ex}      % thickness of \toprule, \bottomrule
\renewcommand{\arraystretch}{1.3}     % spacing (padding)


% \usepackage{bm}

\usepackage{upquote}

$if(geometry)$
\usepackage[$for(geometry)$$geometry$$sep$,$endfor$]{geometry}
$else$
\usepackage[hmargin=2in, marginparsep=0.0 in]{geometry}
$endif$

% Taken from Eisvogel, ln. 312--339
% https://github.com/Wandmalfarbe/pandoc-latex-template/blob/master/eisvogel.tex

$if(listings)$
	\usepackage{listings}
	\newcommand{\passthrough}[1]{#1}
	\lstset{defaultdialect=[5.3]Lua}
	\lstset{defaultdialect=[x86masm]Assembler}
$endif$

$if(listingsNoPageBreak)$
	\usepackage{etoolbox}
	\BeforeBeginEnvironment{lstlisting}{\par\noindent\begin{minipage}{\linewidth}}
	\AfterEndEnvironment{lstlisting}{\end{minipage}\par\addvspace{\topskip}}
$endif$

$if(lhs)$
	\lstnewenvironment{code}{\lstset{language=Haskell,basicstyle=\small\ttfamily}}{}
$endif$

$if(highlighting-macros)$
	$highlighting-macros$

% Workaround/bugfix from jannick0.
% See https://github.com/jgm/pandoc/issues/4302#issuecomment-360669013)
% or https://github.com/Wandmalfarbe/pandoc-latex-template/issues/2
%
% Redefine the verbatim environment 'Highlighting' to break long lines (with
% the help of fvextra). Redefinition is necessary because it is unlikely that
% pandoc includes fvextra in the default template.
	\usepackage{fvextra}
	\DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,
	fontsize=$if(codeBlockFontSize)$$codeBlockFontSize$$else$
	\small$endif$,commandchars=\\\{\}}

$endif$

% Also taken from Eisvogel

\usepackage{graphicx}
\DeclareGraphicsExtensions{.png,.pdf}

$if(graphicsPath)$
\graphicspath{$graphicsPath$}
$endif$

\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
%% Set default figure placement to htbp
% Set default figure placement to t
\makeatletter
%\def\fps@figure{htbp}
\def\fps@figure{t}
\makeatother

% Change figure title
\usepackage[figurename={Figure}, font={small}, labelfont={sf, bf},%
labelsep={period}, justification={raggedright}]{caption}

$if(linksAsNotes)$
	% Make links footnotes instead of hotlinks:
	\DeclareRobustCommand{\href}[2]{#2\footnote{\url{#1}}}
$endif$

\usepackage[unicode=true]{hyperref}

$if(citeColor)$
	\definecolor{citeColor}{HTML}{$citeColor$}
$endif$

$if(urlColor)$
	\definecolor{urlColor}{HTML}{$urlColor$}
$endif$

$if(linkColor)$
	\definecolor{linkColor}{HTML}{$linkColor$}
$endif$


\hypersetup{breaklinks=true,
            bookmarks=true,
            pdfauthor={$author$},
            pdftitle={$title$},
            colorlinks=true,
            citecolor=$if(citeColor)$ \citeColor $else$ black $endif$,
	    urlcolor=$if(urlColor)$ \urlColor $else$ black $endif$,
	    linkcolor=$if(linkColor)$ \linkColor $else$ black $endif$,
            pdfborder={0 0 0},
	    xetex=true,
}
%\def\UrlBreaks{\do\/\do-}
\urlstyle{same}  % don't use monospace font for urls


%\definecolor{blockquote-border}{RGB}{221,221,221}
% redefine footnotes to include character

$if(urlMarkColor)$
	\definecolor{urlMarkColor}{HTML}{$urlMarkColor$}
$else$
	\definecolor{urlMarkColor}{HTML}{ab0f0f}
$endif$

\usepackage{xspace}

$if(urlMarkSymbol)$
	\let\orighref\href
	\renewcommand{\href}[2]{\orighref{#1}{#2{\color{urlMarkColor}%
	\symbolFont{$urlMarkSymbol$}}}} % ugly as sin but it works
$else$

	\let\orighref\href
	%\renewcommand{\href}[2]{\orighref{#1}{#2\color{urlMarkColor}%
	%\rlap{\symbolFont{°}}}} % I wish this would work properly...
	\renewcommand{\href}[2]{\orighref{#1}{#2\color{urlMarkColor}%
	\symbolFont{°}}}

$endif$

\setlength{\emergencystretch}{3em}  % prevent overfull lines

% No clue why I put in numberSections twice
%$if(numberSections)$
%\setcounter{secnumdepth}{5}
%$else$
%\setcounter{secnumdepth}{0}
%$endif$

$if(verbatimInNote)$
\VerbatimFootnotes % allows verbatim text in footnotes
$endif$

$if(title)$
	\title{$title$$if(subtitle)$\\\vspace{-0.5em}{\large $subtitle$}$endif$}
$endif$

$if(author)$
	\author{$for(author)$$author$$sep$ \and $endfor$}
$endif$

$if(date)$
	\date{$date$}
$endif$

$for(headerIncludes)$
$headerIncludes$
$endfor$

\usepackage{titlesec}

$if(numberSections)$
	\setcounter{secnumdepth}{5}
$else$
	\setcounter{secnumdepth}{0}
$endif$

\newcommand{\periodafter}[2]{#1{#2.}}

% taken from https://tex.stackexchange.com/questions/523000/titlesec-right-justified-section-number-in-margin
\newcommand{\marginsecnumber}[1]{%
  \makebox[0pt][r]{#1\hspace{1em}}%
}


\titleformat{\chapter}{\huge\sffamily}{{\color{ruleColor}\thechapter \hspace{0.75pt}  \rule{1.5pt}{\heightof{\sffamily{1234}}}} \hspace{0.5pt}}{0.0em}{}

$if(serifSections)$
\titleformat{\section}{\bfseries\large\rmfamily}{\thesection.}{0.25em}{}
\titleformat{\subsection}{\normalsize\rmfamily}{\thesubsection.}{0.25em}{}
\titleformat{\subsubsection}[runin]{\rmfamily\bfseries\normalsize}{}{0.25em}{\periodafter}

$else$
\titleformat{\section}%
{\large\titletype}%
{\marginsecnumber{\thesection.}}{0em}{}

\titleformat{\subsection}%
{\normalsize\headType}%
{\marginsecnumber{\thesubsection.}}{0em}{}

%\titleformat{\subsubsection}[runin]{\sffamily\bfseries\normalsize}{}{0.25em}{\periodafter}

\definecolor{s2Color}{HTML}{a0a0a0}

\titleformat{\subsubsection}[runin]%
{\subsubHeadType\normalsize\mdseries}%
{\marginsecnumber{\thesubsubsection.}}{0em}{}


\definecolor{parColor}{RGB}{128, 128, 128}

% This will need to be adaptable for two-sided documents
\titleformat{\paragraph}[leftmargin]%
{\color{parColor}\sffamily\small\filright}%
{}{0.0em}{\color{parColor}}[]


$endif$
\titlespacing\section{0pt}{12pt plus 2pt minus 2pt}{3pt plus 2pt minus 2pt}

\titlespacing\subsection{0pt}{12pt plus 2pt minus 2pt}%
{3pt plus 2pt minus 2pt}
%\titlespacing\subsubsection{-0.27em}{12pt plus 2pt minus 2pt}%
%{4pt plus 2pt minus 2pt}
\titlespacing\paragraph{0pt}{0pt plus 2pt minus 2pt}{0pt plus 2pt minus 2pt}


\titlespacing\subsubsection{0em}{12pt plus 2pt minus 2pt}%
{4pt plus 2pt minus 2pt}

\titlespacing\paragraph{8em}{8pt plus 2pt minus 2pt}%
{4pt plus 2pt minus 2pt}

%\titlespacing*{\subsubsection}{-\marginparsep}{*3.25}{*1.5}%

$if(journalSections)$
%\titleformat{\section}{\centering\bfseries\normalsize}{\thesection.}{0.5em}{}

%\titleformat{\section}{\bfseries\Large}{\thesection.}{0.5em}{}
\titleformat{\section}{\bfseries\normalsize\centering}{\thesection.}{0.25em}{}

%\titleformat{\subsection}{\bfseries\normalsize}{\thesubsection.}{0.5em}{}
\titleformat{\subsection}{\bfseries\normalsize}{\thesubsection.}{0.25em}{}

%\titleformat{\subsubsection}[runin]{\sffamily\bfseries\normalsize}{\thesubsubsection.}{0.5em}{\periodafter}
%\titleformat{\subsubsection}[runin]{\sffamily\bfseries\normalsize}{\thesubsubsection. }{0.25em}{}[~ \textsf{|}]
\titleformat{\subsubsection}[runin]{\sffamily\bfseries\normalsize}{\thesubsubsection.}{0.25em}{\periodafter}

\titleformat{\paragraph}{\bfseries\small}{\theparagraph}{1em}{}

\titleformat{\subparagraph}{\sffamily\bfseries\small}{\thesubparagraph}{1em}{}

\titleformat{\subsubparagraph}{\bfseries\sffamily\itshape\small}{\thesubsubparagraph}{1em}{}

$endif$

\definecolor{caption-color}{HTML}{777777}
%
% blockquote
%
%\definecolor{blockquote-border}{RGB}{221,221,221}
\definecolor{blockquote-border}{RGB}{168,168,168}
\definecolor{blockquote-text}{RGB}{0,0,0}
\usepackage{mdframed}
\newmdenv[rightline=false,bottomline=false,topline=false,linewidth=3pt,linecolor=blockquote-border,skipabove=1em,font=\sffamily\small]{customblockquote}
\renewenvironment{quote}{\begin{customblockquote}\vspace{-0.5cm}{\rightmargin=0em\leftmargin=0em}%
\item\relax\color{blockquote-text}\ignorespaces}{\unskip\unskip\end{customblockquote}}

$if(parIndent)$
	\setlength{\parindent}{$parIndent$}
	$else$
	\setlength{\parindent}{1.25em}
$endif$

\usepackage{ragged2e}

$if(parIndent)$
		\setlength\RaggedRightParindent{$parIndent$}
	$else$
		\setlength\RaggedRightParindent{1.25em}
	$endif$

$if(raggedLines)$
	\usepackage[none]{hyphenat}
	%\usepackage{ragged2e}
	\RaggedRight	
$endif$

\newcommand{\dinkus}{\begin{center}* * *\end{center}}

\widowpenalty=2000
\clubpenalty=2000

$if(parSpacing)$
	\setlength{\parskip}{$parSpacing$}
$else$
	\setlength{\parskip}{0cm plus 1mm minus 1mm}
$endif$

\usepackage{lipsum}

\usepackage{datetime2}

\usepackage{tikz}

$if(circuitDiagrams)$
\usepackage{xstring}
	$if(circuitStyle)$
		\usepackage[siunitx, $circuitStyle$]{circuitikz}
	$else$
		\usepackage[siunitx, european]{circuitikz}
	$endif$
$endif$

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}

\usepackage{multicol}

% Taken from the default template
$if(csl-refs)$
\newlength{\cslhangindent}
\setlength{\cslhangindent}{1.5em}
\newlength{\csllabelwidth}
\setlength{\csllabelwidth}{3em}
\newenvironment{CSLReferences}[2] % #1 hanging-ident, #2 entry spacing
 {% don't indent paragraphs
  \setlength{\parindent}{0pt}
  % turn on hanging indent if param 1 is 1
  \ifodd #1 \everypar{\setlength{\hangindent}{\cslhangindent}}\ignorespaces\fi
  % set entry spacing
  \ifnum #2 > 0
  \setlength{\parskip}{#2\baselineskip}
  \fi
 }%
 {}
\usepackage{calc}
\newcommand{\CSLBlock}[1]{#1\hfill\break}
\newcommand{\CSLLeftMargin}[1]{\parbox[t]{\csllabelwidth}{#1}}
\newcommand{\CSLRightInline}[1]{\parbox[t]{\linewidth - \csllabelwidth}{#1}\break}
\newcommand{\CSLIndent}[1]{\hspace{\cslhangindent}#1}
$endif$

% foo
%\if\texttt1
	%\let\emdash{\emdash\emdash}
%\fi

% !!!ALWAYS MAKE SURE THIS IS LOADED *LAST*!!!

$if(includeAtPreamble)$
$includeAtPreamble$
$endif$

\begin{document}

$if(titlepage)$


\begin{titlepage}

$if(titlepageColor)$
	\definecolor{titlepageColor}{HTML}{$titlepageColor$}
	\newpagecolor{titlepageColor}\afterpage{\restorepagecolor}
$endif$

	$if(reportNo)$
		{\color{ruleColor} \noindent\large\textsf{$reportNo$}}
	$else$
		%\vskip \heightof{\large\textsf{1234}}
		\vspace*{\heightof{\large\textsf{1234}}}
	$endif$

	$if(institution)$
		{\noindent\color{ruleColor}%
		\rule{\textwidth-\widthof{\large\textsf{$institution$}}%
		- {1.25 em}}%
		{\heightof{\large\textsf{$institution$}}}% 
		\hspace{0.25 em} {\large\textsf{$institution$}}}
	$else$
		{\noindent\color{ruleColor}\rule{\textwidth}%
		{\heightof{\large\textsf{1234}}}}
	$endif$

	\vspace*{5 cm}
	
	$if(titlepageTextColor)$
	\definecolor{titlepageTextColor}{HTML}{$titlepageTextColor$}
	{\color{titlepageTextColor}
	$endif$
	\begin{flushleft}
		{\Huge\textsf{$title$}}

		$if(subtitle)$
			\vspace*{0.25 cm}
			{\Large\textsf{$subtitle$}}
			\vspace*{\heightof{\Large\textsf{$subtitle$}}}
		$else$
			\vspace*{0.25 cm}
			\vspace*{\heightof{\Large\textsf{1234}}}
		$endif$
	\end{flushleft}


	\begin{flushright}
		{\Large \textsf{$author$}} \\

		\vspace{0.5cm}

		{\Large\textsf{$date$}}
	\end{flushright}

	$if(titlepageTextColor)$
	}
	$endif$

	$if(logo)$
		\begin{figure}[b]
		\includegraphics%
		$if(logoWidth)$[width=$logoWidth$]$endif${$logo$}
		\end{figure}
	$endif$

\end{titlepage}
$elseif(title)$
	\maketitle
$endif$

\newmdenv[rightline=false, leftline=false]{abstractBox}
\renewcommand\abstractname{\sffamily Abstract}

$if(abstract)$


    %$if(titlepage)$
    %\renewcommand\abstractname{\sffamily Abstract}
    %$else$
    %\renewcommand\abstractname{\sffamily Abstract.}
    %$endif$

%\setlength{\absparindent}{0.51em}

% possible spaghetti incoming
$if(titlepage)$
	\begin{abstract}
		$abstract$
	\end{abstract}
$else$
\setlength{\absparindent}{0.51em}


	\begin{abstract}
	\begin{abstractBox} % sometimes we have happy little accidents
		$abstract$
	\end{abstractBox}
	\end{abstract}


$endif$
$endif$

$for(include-before)$
$include-before$

$endfor$
$if(tableOfContents)$
{
\hypersetup{linkcolor=black}
\setcounter{tocdepth}{$toc-depth$}
\tableofcontents
}

\noindent\rule{\linewidth}{0.05em}
$endif$

$body$

$for(include-after)$
$include-after$

$endfor$

$if(include-at-end)$
$include-at-end$
$endif$


$if(useEndnotes)$
\renewcommand{\notesname}{~}

%\begin{center}
%\rule{0.5\linewidth}{\linethickness}
%\end{center}


	%\vspace{-12mm}
\def\enotesize{\normalsize}
\theendnotes
%\endgroup
$endif$

\end{document}
